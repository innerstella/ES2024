# 스코프

## 스코프란?

스코프: 모든 식별자(변수 이름, 함수 이름, 클래스 이름 등)가 자신이 선언된 위치에 의해 다른 코드가 식별자 자신을 참조할 수 있는 유효 범위. 즉 식별자가 유효한 범위.
자바스크립트 엔진이 식별자를 검색할 때 사용하는 규칙.
네임스페이스

네임스페이스(namespace)는 프로그래밍에서 식별자(identifier)의 범위를 나타내는 추상적인 개념이다. 이는 변수, 함수, 클래스 등과 같은 식별자들이 사용될 때, 해당 식별자가 유효한 범위를 정의하는 데 사용된다. 네임스페이스는 이름이 충돌하지 않도록 하고, 코드의 구조를 정리하며, 변수와 함수 등을 구분하여 사용할 수 있도록 도와준다.

- 전역 네임스페이스(Global Namespace)
  전역 범위에서 선언된 변수, 함수, 클래스 등이 있는 공간을 가리킨다. 이곳에서 선언된 것들은 프로그램 전체에서 접근 가능하다.
- 로컬 네임스페이스(Local Namespace)
  함수 내에서 선언된 변수와 매개변수 등이 속하는 범위를 가리킨다. 이 범위에 속한 변수는 해당 함수 내에서만 유효하며, 함수가 호출될 때마다 생성되고 파괴된다.
- 클래스 네임스페이스(Class Namespace)
  클래스 내에서 선언된 변수, 메서드 등이 속하는 범위를 가리킨다. 클래스의 인스턴스를 생성할 때마다 클래스 네임스페이스의 복사본이 만들어지고 해당 인스턴스에서 사용된다.
- 모듈 네임스페이스(Module Namespace)
  모듈 내에서 선언된 변수, 함수, 클래스 등이 속하는 범위를 가리킨다. 모듈은 파일 단위로 구분되며, 해당 파일 내에서 정의된 것들은 모듈 네임스페이스에 속한다.

```javascript
function outerFunction() {
  const outerVariable = "I am in the outer function scope";

  function innerFunction() {
    const innerVariable = "I am in the inner function scope";

    console.log(innerVariable);
  }
  innerFunction();

  console.log(outerVariable);
}

outerFunction();
```

// 외부 함수 스코프 변수에 접근 시 에러 발생
// console.log(outerVariable); // 에러: outerVariable is not defined
// console.log(innerVariable); // 에러: innerVariable is not defined

=> 스코프라는 개념이 없다면 같은 이름을 갖는 변수는 충돌을 일으키므로 프로그램 전체에서 하나밖에 사용할 수 없다.

## 스코프의 종류

코드는 전역과 지역으로 구분할 수 있다.
이때 변수는 자신이 선언된 위치에 의해 자신이 유효한 범위인 스코프가 결정된다.

### 전역과 전역 스코프

전역에 변수를 선언하면 전역 변수가 되고, 전역 변수는 어디서든지 참조할 수 있다.

### 지역과 지역 스코프

지역이란 함수 몸체 내부를 말하는데, 지역에 변수를 선언하면 지역 변수가 되고, 이 지역 변수는 자신의 지역 스코프와 하위 지역 스코프에서만 참조할 수 있다.

## 스코프 체인

함수 몸체 내부에서 함수가 정의된 것을 '함수의 중첩'이라 하는데, 함수가 중첩될 수 있으므로 함수의 지역 스코프도 중첩될 수 있다. => 스코프가 함수의 중첩에 의해 계층적 구조를 갖는다.

모든 스코프는 하나의 계층적 구조로 연결되며, 모든 지역 스코프의 최상위 스코프는 전역 스코프다.
이렇게 스코프가 계층적으로 연결된 것을 스코프 체인이라 한다.

변수를 참조할 때 자바스크립트 엔진은 스코프 체인을 통해 변수를 참조하는 코드의 스코프에서 시작하여 상위 스코프 방향으로 이동하며 선언된 변수를 검색한다.

자바스크립트 엔진은 코드를 실행하기전에 렉시컬 환경을 실제로 생성한다.

### 렉시컬 환경

렉시컬 환경(lexical environment)은 자바스크립트에서 스코프, 식별자, 변수, 함수 등의 정보를 관리하는 객체이다.

환경 레코드(Environment Record)
환경 레코드는 변수와 함수 선언과 같은 식별자에 대한 정보를 저장하는 곳이다.
선언된 변수, 함수, 매개변수 등의 정보를 기록하며, 이 정보를 바탕으로 스코프에서 해당 식별자에 접근할 수 있다.

외부 렉시컬 환경 참조(Outer Lexical Environment Reference)
현재 스코프의 외부 스코프, 즉 상위 스코프에 대한 참조를 가지고 있다.
이를 통해 스코프 체인(scope chain)을 형성하고, 외부 스코프의 변수에 접근할 수 있게 한다.

렉시컬 환경은 크게 전역 환경과 함수 환경으로 나뉜다. 전역 환경은 코드의 최상위 레벨에서 실행되는 환경이고, 함수 환경은 함수가 호출될 때마다 생성되는 환경이다.

렉시컬 환경은 클로저(closure) 구현에 핵심적인 역할을 한다. 함수는 자신이 정의된 스코프에 대한 렉시컬 환경을 유지하면서 외부 변수에 접근할 수 있다. 이를 통해 함수가 호출된 이후에도 해당 함수의 렉시컬 환경이 유지되어 있는 동안 외부 변수에 접근할 수 있게 된다.

```javascript
function outerFunction() {
  const outerVar = "I am in the outer function";

  function innerFunction() {
    const innerVar = "I am in the inner function";
    console.log(outerVar);
  }

  innerFunction();
}

outerFunction();
```

### 클로저

클로저(Closure)는 함수와 그 함수가 선언된 렉시컬 스코프(Lexical Scope) 사이의 관계를 나타낸다. 이는 함수가 다른 스코프에서 호출될 때도 해당 함수가 선언된 스코프에 접근할 수 있음을 의미한다. 클로저는 렉시컬 스코프의 특성을 기반으로 동작하며, 외부 함수의 변수에 접근할 수 있는 함수를 생성하는 메커니즘이다.

### 스코프 체인에 의한 변수 검색

자바스크립트 엔진은 스코프 체인을 따라 변수를 참조하는 코드의 스코프에서 시작해서 상위 스코프 방향으로 이동하며 선언된 변수를 검색하기 때문에 상위 스코프에서 유효한 변수는 하위 스코프에서 자유롭게 참조할 수 있지만, 하위 스코프에서 유효한 변수를 상위 스코프에서 참조할 수 없다.

### 스코프 체인에 의한 함수 검색

함수 선언문으로 함수를 정의하면 런타임 이전에 함수 객체가 먼저 생성되고, 함수 이름과 동일한 이름의 식별자를 암묵적으로 선언하고 생성된 함수 객체를 할당한다. 함수도 식별자에 할당되기 때문에 스코프를 갖는다.
따라서 스코프를 "식별자를 검색하는 규칙"으로 생각하는게 더 적합하다.

## 함수 레벨 스코프

"지역"은 함수 몸체 내부를 말하므로, 코드 블록이 아닌 함수에 의해서만 지역 스코프가 생성된다.
블록 레벨 스코프: 모든 코드 블록이 지역 스코프를 만드는것.
함수 레벨 스코프: var키워드로 선언된 변수는 오로지 함수의 코드 블록만을 지역 스코프로 인정하는것.

## 렉시컬 스코프

### 동적 스코프

함수를 어디서 호출했는지에 따라 함수의 상위 스코프를 결정하는것

### 렉시컬 스코프(정적 스코프)

함수를 어디서 정의했는지에 따라 함수의 상위 스코프를 결정하는것

자바스크립트는 렉시컬 스코프를 따르므로 함수를 어디서 정의했는지에 따라 상위 스코프를 결정한다. 함수가 호출된 위치는 상위 스코프 결정에 어떠한 영향도 주지 않는다. => 함수의 상위 스코프는 언제나 자신이 정의된 스코프다.

함수의 상위 스코프는 함수 정의가 실행될 때 정적으로 결정된다. 함수 정의가 실행되어 생성된 함수 객체는 함수가 호출될 때마다 함수의 상위 스코프를 참조할 필요가 있기 때문에, 이렇게 결정된 상위 스코프를 기억한다.
